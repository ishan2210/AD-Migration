# Import the Active Directory module if not already loaded
Import-Module ActiveDirectory

# Define the domain
$domain = "merittrac.net"  # Replace with the actual domain name

# Get all user accounts in the domain
$users = Get-AdUser -Filter {(ObjectClass -eq "user")} -SearchBase "DC=$domain,DC=com" -Properties "UserCannotChangePassword"

# Loop through each user and set the "User cannot change password" option
foreach ($user in $users) {
    if (-not $user.UserCannotChangePassword) {
        Set-AdUser -Identity $user -CannotChangePassword $true
        Write-Host "User '$($user.SamAccountName)' in domain '$domain' cannot change their password."
    } else {
        Write-Host "User '$($user.SamAccountName)' in domain '$domain' already cannot change their password."
    }
}

Write-Host "The 'User cannot change password' option has been set for all user accounts in domain '$domain'."



